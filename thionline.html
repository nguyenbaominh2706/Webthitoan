<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra trực tuyến</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            width: 100%;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: #2575fc;
        }
        
        h3 {
            font-size: 1.3rem;
            margin: 15px 0 12px;
            color: #6a11cb;
        }
        
        p {
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        
        .intro {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .grade-section {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            width: 100%;
        }
        
        .grade-section:hover {
            transform: translateY(-3px);
        }
        
        .exam-list {
            list-style-type: none;
        }
        
        .exam-list li {
            margin-bottom: 8px;
            padding: 12px 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.95rem;
        }
        
        .exam-list li:hover {
            background-color: #e9ecef;
        }
        
        .exam-codes {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        .exam-codes.active {
            display: block;
        }
        
        .exam-codes-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .exam-code {
            padding: 10px 15px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            flex: 1;
            min-width: 80px;
            transition: all 0.3s;
        }
        
        .exam-code:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: center;
            margin: 5px 0;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-fullscreen {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            margin: 5px 0;
        }
        
        .exam-container {
            display: none;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            width: 100%;
            overflow-x: hidden;
        }
        
        /* Bố cục mới cho màn hình làm bài thi - Tối ưu cho mobile */
        .exam-layout {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 80vh;
        }
        
        .exam-question-panel {
            width: 100%;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.05);
            height: 70vh;
        }
        
        .exam-answer-panel {
            width: 100%;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            height: 20vh;
        }
        
        .timer {
            font-size: 1.4rem;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .question-section {
            margin-bottom: 20px;
        }
        
        .question {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .question-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        input[type="radio"], input[type="checkbox"] {
            width: 20px;
            height: 20px;
            min-width: 20px;
        }
        
        .short-answer {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 1rem;
        }
        
        .result-container {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2575fc;
            margin: 15px 0;
        }
        
        .score-zero {
            color: #e74c3c;
        }
        
        .score-details {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
        }
        
        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .score-item {
            background-color: white;
            padding: 12px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6a11cb;
        }
        
        .score-label {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            padding: 15px 0;
            margin-top: 20px;
            color: #777;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        .exam-content {
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            background-color: #fff9f9;
            width: 100%;
            overflow: hidden;
        }
        
        .exam-title {
            color: #e74c3c;
            font-size: 1.2rem;
            margin-bottom: 12px;
            text-align: center;
            font-weight: bold;
        }
        
        /* KHUNG XEM ĐỀ THI - SCROLL PDF */
.exam-frame-container {
    width: 100%;
    height: 75vh; /* Chiều cao cố định để iframe scroll được bên trong */
    border-radius: 8px;
    margin: 20px 0;
    background: #f8f9fa;
    padding: 15px;
    border: 2px solid #2575fc;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.exam-frame {
    width: 100%;
    height: 100%; /* Chiếm toàn bộ chiều cao container */
    border: 1px solid #ddd;
    border-radius: 8px;
    background: white;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: block;
}

/* điều chỉnh */
@media (min-width: 768px) {
    .exam-frame-container {
        height: 80vh;
    }

    .exam-frame {
        width: 100%;
        max-width: 900px;
        height: 100%;
        margin: 0 auto;
    }
}

/* Tối ưu cho màn hình rất nhỏ */
@media (max-width: 480px) {
    .exam-frame-container {
        height: 65vh;
        padding: 10px;
    }
}

/* Tối ưu cho landscape mode */
@media (orientation: landscape) and (max-height: 600px) {
    .exam-frame-container {
        height: 70vh;
    }
}

/* Fullscreen mode */
body:fullscreen .exam-frame-container,
body:-webkit-full-screen .exam-frame-container,
body:-moz-full-screen .exam-frame-container,
body:-ms-fullscreen .exam-frame-container {
    height: 85vh;
    padding: 10px;
}

body:fullscreen .exam-frame,
body:-webkit-full-screen .exam-frame,
body:-moz-full-screen .exam-frame,
body:-ms-fullscreen .exam-frame {
    width: 100%;
    max-width: 95vw;
    height: 100%;
}
        
        .exam-zoom-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .zoom-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .exam-instructions {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        /* Fullscreen mode tối ưu cho mobile */
        body:fullscreen .exam-container,
        body:-webkit-full-screen .exam-container,
        body:-moz-full-screen .exam-container,
        body:-ms-fullscreen .exam-container {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 10px;
            border-radius: 0;
        }
        
        body:fullscreen .exam-frame,
        body:-webkit-full-screen .exam-frame,
        body:-moz-full-screen .exam-frame,
        body:-ms-fullscreen .exam-frame {
            height: 70vh;
        }
        
        .fullscreen-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .fullscreen-controls .btn {
            margin: 0;
        }
        
        .fullscreen-message {
            display: none;
            background-color: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        body:fullscreen .fullscreen-message,
        body:-webkit-full-screen .fullscreen-message,
        body:-moz-full-screen .fullscreen-message,
        body:-ms-fullscreen .fullscreen-message {
            display: block;
        }
        
        .warning-message {
            background-color: #f39c12;
            color: white;
            padding: 12px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 12px;
            font-weight: bold;
            display: none;
            font-size: 0.9rem;
        }
        
        .cheat-detected {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 15px 0;
            font-size: 1rem;
        }
        
        .correct-answer {
            color: #27ae60;
            font-weight: bold;
        }
        
        .wrong-answer {
            color: #e74c3c;
            text-decoration: line-through;
        }
        
        .user-answer {
            color: #3498db;
            font-weight: bold;
        }
        
        /* Responsive cho tablet */
        @media (min-width: 768px) {
            .container {
                padding: 20px;
            }
            
            header {
                padding: 25px 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.7rem;
            }
            
            h3 {
                font-size: 1.4rem;
            }
            
            .menu {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .grade-section {
                flex: 1;
                min-width: calc(50% - 10px);
            }
            
            .btn {
                width: auto;
                margin: 0 5px;
            }
            
            .fullscreen-controls {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .exam-layout {
                flex-direction: row;
                height: 85vh;
            }
            
            .exam-question-panel {
                flex: 8;
                height: 100%;
            }
            
            .exam-answer-panel {
                flex: 2;
                height: 100%;
            }
        }
        
        /* Responsive cho desktop */
        @media (min-width: 1024px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .grade-section {
                min-width: calc(33.333% - 15px);
            }
        }
        
        /* Điều chỉnh cho màn hình rất nhỏ */
        @media (max-width: 360px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 15px 10px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            .score {
                font-size: 2rem;
            }
        }
        
        /* Tối ưu cho landscape mode */
        @media (orientation: landscape) and (max-height: 600px) {
            .exam-layout {
                flex-direction: row;
                height: 70vh;
            }
            
            .timer {
                font-size: 1.2rem;
                padding: 8px;
            }
        }
        
        /* Tăng kích thước nút cho dễ chạm trên mobile */
        button, input[type="radio"], input[type="checkbox"], .exam-list li {
            min-height: 44px;
        }
        
        .option label {
            padding: 5px 0;
            display: block;
        }
        
        /* Animation cho exam-code */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .exam-code {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Kiểm tra trực tuyến</h1>
            <p>Nền tảng ôn luyện và kiểm tra kiến thức Toán học</p>
        </header>
        
        <section class="intro">
            <h2>Giới thiệu</h2>
            <p>Chào mừng bạn đến với Kiểm tra trực tuyến - nền tảng hỗ trợ học tập và ôn luyện môn Toán dành cho học sinh từ lớp 10 đến lớp 12.</p>
            <p>Web cung cấp các đề kiểm tra theo chương trình học, giúp học sinh củng cố kiến thức và chuẩn bị tốt cho các kỳ kiểm tra quan trọng.</p>
            <p>Với giao diện thân thiện, dễ sử dụng và hệ thống chấm điểm tự động, Kiểm tra trực tuyến là công cụ hữu ích cho việc tự học và đánh giá năng lực.</p>
            <p><strong>Lưu ý:</strong> Hệ thống có tính năng chống gian lận. Nếu bạn thoát khỏi màn hình kiểm tra hoặc chuyển tab trong khi kiểm tra, bài kiểm tra sẽ tự động bị chấm 0 điểm.</p>
        </section>
        
        <section class="menu">
            <div class="grade-section">
                <h2>Toán 10</h2>
                <ul class="exam-list">
                    <li onclick="toggleExamCodes('toan10-gk1')">Đề kiểm tra giữa kỳ 1</li>
                    <div id="toan10-gk1-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan10-gk1', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-gk1', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-gk1', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-gk1', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan10-ck1')">Đề kiểm tra cuối kỳ 1</li>
                    <div id="toan10-ck1-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan10-ck1', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-ck1', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-ck1', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-ck1', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan10-gk2')">Đề kiểm tra giữa kỳ 2</li>
                    <div id="toan10-gk2-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan10-gk2', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-gk2', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-gk2', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-gk2', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan10-ck2')">Đề kiểm tra cuối kỳ 2</li>
                    <div id="toan10-ck2-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan10-ck2', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-ck2', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-ck2', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan10-ck2', '004')">Đề số 4</div>
                        </div>
                    </div>
                </ul>
            </div>
            
            <div class="grade-section">
                <h2>Toán 11</h2>
                <ul class="exam-list">
                    <li onclick="toggleExamCodes('toan11-gk1')">Đề kiểm tra giữa kỳ 1</li>
                    <div id="toan11-gk1-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan11-gk1', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-gk1', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-gk1', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-gk1', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan11-ck1')">Đề kiểm tra cuối kỳ 1</li>
                    <div id="toan11-ck1-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan11-ck1', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-ck1', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-ck1', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-ck1', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan11-gk2')">Đề kiểm tra giữa kỳ 2</li>
                    <div id="toan11-gk2-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan11-gk2', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-gk2', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-gk2', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-gk2', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan11-ck2')">Đề kiểm tra cuối kỳ 2</li>
                    <div id="toan11-ck2-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan11-ck2', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-ck2', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-ck2', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan11-ck2', '004')">Đề số 4</div>
                        </div>
                    </div>
                </ul>
            </div>
            
            <div class="grade-section">
                <h2>Toán 12</h2>
                <ul class="exam-list">
                    <li onclick="toggleExamCodes('toan12-gk1')">Đề kiểm tra giữa kỳ 1</li>
                    <div id="toan12-gk1-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan12-gk1', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-gk1', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-gk1', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-gk1', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan12-ck1')">Đề kiểm tra cuối kỳ 1</li>
                    <div id="toan12-ck1-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan12-ck1', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-ck1', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-ck1', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-ck1', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan12-gk2')">Đề kiểm tra giữa kỳ 2</li>
                    <div id="toan12-gk2-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan12-gk2', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-gk2', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-gk2', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-gk2', '004')">Đề số 4</div>
                        </div>
                    </div>
                    
                    <li onclick="toggleExamCodes('toan12-ck2')">Đề kiểm tra cuối kỳ 2</li>
                    <div id="toan12-ck2-codes" class="exam-codes">
                        <p>Chọn đề:</p>
                        <div class="exam-codes-list">
                            <div class="exam-code" onclick="selectExamCode('toan12-ck2', '001')">Đề số 1</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-ck2', '002')">Đề số 2</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-ck2', '003')">Đề số 3</div>
                            <div class="exam-code" onclick="selectExamCode('toan12-ck2', '004')">Đề số 4</div>
                        </div>
                    </div>
                </ul>
            </div>
        </section>
        
        <div id="exam-selection" style="text-align: center; margin-bottom: 30px; display: none;">
            <p>Bạn đã chọn: <span id="selected-exam-name"></span></p>
            <p>Đề số: <span id="selected-exam-code"></span></p>
            <button class="btn" onclick="startExam()">Bắt đầu kiểm tra</button>
        </div>
        
        <div id="exam-container" class="exam-container">
            <div class="fullscreen-controls">
                <div class="timer" id="timer">60:00</div>
                <div>
                    <button class="btn btn-fullscreen" onclick="toggleFullscreen()">Toàn màn hình</button>
                    <button class="btn" onclick="submitExam()">Nộp bài</button>
                </div>
            </div>
            
            <div class="fullscreen-message" id="fullscreen-message">
                Bạn đang ở chế độ toàn màn hình. Thoát khỏi chế độ này sẽ bị tính là vi phạm quy chế kiểm tra!
            </div>
            
            <div class="warning-message" id="warning-message">
                CẢNH BÁO: Bạn đã rời khỏi màn hình kiểm tra lần thứ <span id="warning-count">0</span>/3. Nếu vi phạm lần thứ 4, bài kiểm tra sẽ bị hủy với 0 điểm!
            </div>
            
            <div id="cheat-detected-message" class="cheat-detected" style="display: none;">
                <h3>⚠️ VI PHẠM QUY CHẾ KIỂM TRA ⚠️</h3>
                <p>Bạn đã rời khỏi màn hình kiểm tra quá nhiều lần.</p>
                <p>Bài kiểm tra của bạn đã bị hủy với 0 điểm.</p>
            </div>
            
            <div class="exam-layout">
                <div class="exam-question-panel">
                    <div class="exam-content">
                        <div class="exam-title" id="exam-title">ĐỀ KIỂM TRA MÔN TOÁN</div>
                        <div id="exam-description">
                            <!-- Nội dung đề thi sẽ được hiển thị ở đây -->
                        </div>
                    </div>
                </div>
                
                <div class="exam-answer-panel">
                    <div class="question-section">
                        <h3>A. Trắc nghiệm nhiều lựa chọn (12 câu × 0.25 điểm = 3 điểm)</h3>
                        <div id="multiple-choice-questions">
                            <!-- Câu hỏi trắc nghiệm sẽ được thêm ở đây -->
                        </div>
                    </div>
                    
                    <div class="question-section">
                        <h3>B. Trắc nghiệm đúng/sai (3 câu × 1 điểm = 3 điểm)</h3>
                        <div id="true-false-questions">
                            <!-- Câu hỏi đúng/sai sẽ được thêm ở đây -->
                        </div>
                    </div>
                    
                    <div class="question-section">
                        <h3>C. Trả lời ngắn (8 câu × 0.5 điểm = 4 điểm)</h3>
                        <div id="short-answer-questions">
                            <!-- Câu hỏi trả lời ngắn sẽ được thêm ở đây -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="result-container" class="result-container">
            <h2>Kết quả bài kiểm tra</h2>
            <div class="score" id="score">0/10</div>
            <p id="result-details"></p>
            
            <div class="score-details">
                <h3>Chi tiết điểm số</h3>
                <div class="score-breakdown">
                    <div class="score-item">
                        <div class="score-value" id="mc-score">0</div>
                        <div class="score-label">Trắc nghiệm<br>(3 điểm tối đa)</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="tf-score">0</div>
                        <div class="score-label">Đúng/Sai<br>(3 điểm tối đa)</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="sa-score">0</div>
                        <div class="score-label">Trả lời ngắn<br>(4 điểm tối đa)</div>
                    </div>
                </div>
            </div>
            
            <div id="answer-review" style="display: none; margin-top: 20px; text-align: left;">
                <h3>Xem lại đáp án</h3>
                <div id="answer-details"></div>
            </div>
            
            <div id="cheat-penalty-message" style="display: none; color: #e74c3c; font-weight: bold; margin: 15px 0;">
                ⚠️ Bài kiểm tra của bạn bị hủy do vi phạm quy chế: Rời khỏi màn hình kiểm tra nhiều lần.
            </div>
            <button class="btn btn-secondary" onclick="goHome()">Quay lại trang chủ</button>
        </div>
        
        <footer>
            <p style="font-size: 0.9rem; color: #e74c3c; margin-top: 10px;">Hệ thống có tính năng chống gian lận - Không thoát màn hình khi đang kiểm tra</p>
        </footer>
    </div>
    <script>
    let selectedExam = '';
    let selectedExamCode = '';
    let timerInterval;
    let timeLeft = 60 * 60; // 60 phút tính bằng giây
    let isFullscreen = false;
    let isExamActive = false;
    let violationCount = 0;
    let cheatDetected = false;
    let lastFocusTime = Date.now();
    let visibilityWarningShown = false;
    
    // Đáp án cho đề thi 
    const examAnswers = {
        
        'toan10-gk1-001': {
            multipleChoice: [
                'C', 'D', 'A', 'A', 'A', 'D', 'B', 'D', 'B', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Sai', 'Đúng'],
                ['Sai', 'Đúng', 'Sai', 'Đúng']
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12'
            ]
        },
        'toan10-gk1-002': {
            multipleChoice: [
                'D', 'B', 'B', 'A', 'B', 'B', 'D', 'D', 'B', 'C',
                'B', 'C'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Sai'],
                ['Sai', 'Đúng', 'Đúng', 'Đúng'],
                ['Đúng', 'Đúng', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '-2', '37', '2203', '8', '[2;10/3]', '(3 căn 3)/2'
            ]
        },
        'toan10-gk1-003': {
            multipleChoice: [
                'C', 'D', 'A', 'A', 'A', 'D', 'B', 'D', 'B', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Sai', 'Đúng'],
                ['Sai', 'Đúng', 'Sai', 'Đúng']
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12'
            ]
        },
        'toan10-gk1-004': {
            multipleChoice: [
                'C', 'D', 'A', 'A', 'A', 'D', 'B', 'D', 'B', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Sai', 'Đúng'],
                ['Sai', 'Đúng', 'Sai', 'Đúng']
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12'
            ]
        },
        'toan10-ck1-001': {
            multipleChoice: [
                'C', 'D', 'A', 'A', 'A', 'D', 'B', 'D', 'B', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'], 
                ['Đúng', 'Sai', 'Sai', 'Đúng'], 
                ['Sai', 'Đúng', 'Sai', 'Đúng']  
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12'
            ]
        },
        'toan10-ck1-002': {
            multipleChoice: [
                'B', 'B', 'D', 'A', 'C', 'B', 'A', 'C', 'B', 'B',
                'A', 'A'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Đúng', 'Đúng']
            ],
            shortAnswer: [
                '10', '2', '2.07', '4', '314.6', 'a/2', '-5;2'
            ]
        },
        'toan10-ck1-003': {
            multipleChoice: [
                'C', 'D', 'A', 'A', 'A', 'D', 'B', 'D', 'B', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Sai', 'Đúng'],
                ['Sai', 'Đúng', 'Sai', 'Đúng']
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12'
            ]
        },
        'toan10-ck1-004': {
            multipleChoice: [
                'C', 'D', 'A', 'A', 'A', 'D', 'B', 'D', 'B', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Sai', 'Đúng'],
                ['Sai', 'Đúng', 'Sai', 'Đúng']
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12'
            ]
        },
        'toan10-gk2-001': {
            multipleChoice: [
                'D', 'B', 'B', 'A', 'C', 'A', 'B', 'D', 'C', 'A',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], 
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], 
            ],
            shortAnswer: [
                '10',          // Câu 1
                '2',           // Câu 2
                '5',            // Câu 3
                '0.89',         // Câu 4
                '-x^2+2x+3', // Câu 5 
                '-7<m<-3', // Câu 6
                '1', 
                '(x-3)^2+(y-2)^2=10'  
            ]
        },
        'toan10-gk2-002': {
            multipleChoice: [
                'D', 'A', 'D', 'C', 'A', 'D', 'D', 'C', 'A', 'D',
                'A', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Sai', 'Đúng'],
                ['Đúng', 'Sai', 'Đúng', 'Đúng']
            ],
            shortAnswer: [
                '37', '-35', '27', '-1.5', '5/4', '4.5', '2101.80', 'x-2y-3=0'
            ]
        },
        'toan10-gk2-003': {
            multipleChoice: [
                'D', 'B', 'B', 'A', 'C', 'A', 'B', 'D', 'C', 'A',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], 
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], 
            ],
            shortAnswer: [
                '10',          // Câu 1
                '2',           // Câu 2
                '5',            // Câu 3
                '0.89',         // Câu 4
                '-x^2+2x+3', // Câu 5 
                '-7<m<-3', // Câu 6
                '1', 
                '(x-3)^2+(y-2)^2=10'  
            ]
        },'toan10-gk2-004': {
            multipleChoice: [
                'D', 'B', 'B', 'A', 'C', 'A', 'B', 'D', 'C', 'A',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], 
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], 
            ],
            shortAnswer: [
                '10',          // Câu 1
                '2',           // Câu 2
                '5',            // Câu 3
                '0.89',         // Câu 4
                '-x^2+2x+3', // Câu 5 
                '-7<m<-3', // Câu 6
                '1', 
                '(x-3)^2+(y-2)^2=10'  
            ]
        },
        'toan10-ck2-001': {
            multipleChoice: [
                'A', 'B', 'D', 'A', 'B', 'C', 'D', 'B', 'A', 'A',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
                
            ],
            shortAnswer: [
                '6',          // Câu 1
                '1080',           // Câu 2
                '50',            // Câu 3
                '7.62',         // Câu 4
                '2x-y-7=0', // Câu 5 
                '30', // Câu 6
                '5', // Câu 7
                '10'  // Câu 8
            ]
        },
        'toan10-ck2-002': {
            multipleChoice: [
                'B', 'B', 'D', 'D', 'C', 'B', 'A', 'B', 'A', 'B',
                'C', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Đúng', 'Sai'],
                ['Sai', 'Sai', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '180', '4.5', '48', '5', '20', '76767600', '232025/248832',
            ]
        },
        'toan10-ck2-003': {
           multipleChoice: [
                'A', 'B', 'D', 'A', 'B', 'C', 'D', 'B', 'A', 'A',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
                
            ],
            shortAnswer: [
                '6',          // Câu 1
                '1080',           // Câu 2
                '50',            // Câu 3
                '7.62',         // Câu 4
                '2x-y-7=0', // Câu 5 
                '30', // Câu 6
                '5', // Câu 7
                '10'  // Câu 8
            ]
        },
        'toan10-ck2-004': {
            multipleChoice: [
                'A', 'B', 'D', 'A', 'B', 'C', 'D', 'B', 'A', 'A',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
                
            ],
            shortAnswer: [
                '6',          // Câu 1
                '1080',           // Câu 2
                '50',            // Câu 3
                '7.62',         // Câu 4
                '2x-y-7=0', // Câu 5 
                '30', // Câu 6
                '5', // Câu 7
                '10'  // Câu 8
            ]
        },
        'toan11-gk1-001': {
            multipleChoice: [
                'A', 'D', 'C', 'B', 'C', 'D', 'C', 'A', 'A', 'C',
                'C', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 3: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 4: a,b,c,d
                
            ],
            shortAnswer: [
                '8 / 31',          // Câu 1
                '3',           // Câu 2
                '5',            // Câu 3
                
            ]
        },
        'toan11-gk1-002': {
            multipleChoice: [
                'A', 'D', 'A', 'D', 'C', 'B', 'C', 'D', 'A', 'B',
                'C', 'B'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Đúng', 'Sai'],
                ['Sai', 'Đúng', 'Đúng', 'Sai'],
                ['Đúng', 'Đúng', 'Sai', 'Đúng'],
                ['Đúng', 'Đúng', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '0.19', '53', '4', '3.25', '-2;2', '34.2', '2', '5/12' //chx sửa
            ]
        },
        'toan11-gk1-003': {
            multipleChoice: [
                'A', 'D', 'C', 'B', 'C', 'D', 'C', 'A', 'A', 'C',
                'C', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 3: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 4: a,b,c,d
                
            ],
            shortAnswer: [
                '8 / 31',          // Câu 1
                '3',           // Câu 2
                '5',            // Câu 3
                
            ]
        },
        'toan11-gk1-004': {
            multipleChoice: [
                'A', 'D', 'C', 'B', 'C', 'D', 'C', 'A', 'A', 'C',
                'C', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 3: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 4: a,b,c,d
                
            ],
            shortAnswer: [
                '8 / 31',          // Câu 1
                '3',           // Câu 2
                '5',            // Câu 3
                
            ]
        },
        'toan11-ck1-001': {
            multipleChoice: [
                'B', 'B', 'C', 'A', 'A', 'C', 'B', 'C', 'C', 'D',
                'B', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
                ['Sai', 'Đúng', 'Sai', 'Đúng'], // Câu 3: a,b,c,d
                
            ],
            shortAnswer: [
                '130',          // Câu 1
                '5',           // Câu 2
                '9',            // Câu 3
                '-0.5',         // Câu 4
                '30', // Câu 5 
                '(3a^2 căn 3)/16', // Câu 6
                '30', // Câu 7
            ]
        },'toan11-ck1-002': {
            multipleChoice: [
                'A', 'B', 'D', 'B', 'A', 'A', 'C', 'D', 'D', 'D',
                'B', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Đúng', 'Đúng']
            ],
            shortAnswer: [
                '2', '-5', '65', '17'
            ]
        },
        'toan11-ck1-003': {
            multipleChoice: [
                'B', 'B', 'C', 'A', 'A', 'C', 'B', 'C', 'C', 'D',
                'B', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
                ['Sai', 'Đúng', 'Sai', 'Đúng'], // Câu 3: a,b,c,d
                
            ],
            shortAnswer: [
                '130',          // Câu 1
                '5',           // Câu 2
                '9',            // Câu 3
                '-0.5',         // Câu 4
                '30', // Câu 5 
                '(3a^2 căn 3)/16', // Câu 6
                '30', // Câu 7
            ]
        },'toan11-ck1-004': {
            multipleChoice: [
                'B', 'B', 'C', 'A', 'A', 'C', 'B', 'C', 'C', 'D',
                'B', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
                ['Sai', 'Đúng', 'Sai', 'Đúng'], // Câu 3: a,b,c,d
                
            ],
            shortAnswer: [
                '130',          // Câu 1
                '5',           // Câu 2
                '9',            // Câu 3
                '-0.5',         // Câu 4
                '30', // Câu 5 
                '(3a^2 căn 3)/16', // Câu 6
                '30', // Câu 7
            ]
        },
        'toan11-gk2-001': {
            multipleChoice: [
                'C', 'A', 'D', 'A', 'A', 'C', 'D', 'C', 'C', 'A',
                'B', 'A'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '60',          // Câu 1
                '10',           // Câu 2
                '1.5',            // Câu 3
                '9',         // Câu 4
                '-1;2', // Câu 5 
                '24 độ 5 phút', // Câu 6
                '112 độ 26 phút 16 giây', // Câu 7
            ]
        },
        'toan11-gk2-002': {
            multipleChoice: [
                'C', 'D', 'B', 'D', 'B', 'A', 'B', 'C', 'A', 'C',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'],
                ['Đúng', 'Sai', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '7', '10', '2.56', '375', 'a^2', '5', '-1;3/7', '10^6'
            ]
        },
        'toan11-gk2-003': {
            multipleChoice: [
                'C', 'A', 'D', 'A', 'A', 'C', 'D', 'C', 'C', 'A',
                'B', 'A'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '60',          // Câu 1
                '10',           // Câu 2
                '1.5',            // Câu 3
                '9',         // Câu 4
                '-1;2', // Câu 5 
                '24 độ 5 phút', // Câu 6
                '112 độ 26 phút 16 giây', // Câu 7
            ]
        },
        'toan11-gk2-004': {
            multipleChoice: [
                'C', 'A', 'D', 'A', 'A', 'C', 'D', 'C', 'C', 'A',
                'B', 'A'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '60',          // Câu 1
                '10',           // Câu 2
                '1.5',            // Câu 3
                '9',         // Câu 4
                '-1;2', // Câu 5 
                '24 độ 5 phút', // Câu 6
                '112 độ 26 phút 16 giây', // Câu 7
            ]
        },
        'toan11-ck2-001': {
            multipleChoice: [
                'A', 'D', 'D', 'A', 'C', 'C', 'A', 'C', 'A', 'C',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '89',          // Câu 1
                '43',           // Câu 2
                '0.45',            // Câu 3
                '0.29',         // Câu 4
                '(a căn 15) / 5', // Câu 5 
                '(3 căn 3) / 2', // Câu 6
                '1 / 4', // Câu 7
                '0.708', // Câu 8
            ]
        },
        'toan11-ck2-002': {
            multipleChoice: [
                'A', 'C', 'D', 'B', 'A', 'C', 'C', 'D', 'A', 'D',
                'B', 'B'
            ],
            trueFalse: [
                ['Sai', 'Đúng', 'Sai', 'Đúng'],
                ['Đúng', 'Sai', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '10', '0.05', '245', '14', '2', '517.5', '5/9', '16/35'
            ]
        },
        'toan11-ck2-003': {
            multipleChoice: [
                'A', 'D', 'D', 'A', 'C', 'C', 'A', 'C', 'A', 'C',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '89',          // Câu 1
                '43',           // Câu 2
                '0.45',            // Câu 3
                '0.29',         // Câu 4
                '(a căn 15) / 5', // Câu 5 
                '(3 căn 3) / 2', // Câu 6
                '1 / 4', // Câu 7
                '0.708', // Câu 8
            ]
        },
        'toan11-ck2-004': {
            multipleChoice: [
                'A', 'D', 'D', 'A', 'C', 'C', 'A', 'C', 'A', 'C',
                'B', 'C'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Đúng', 'Sai', 'Sai', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '89',          // Câu 1
                '43',           // Câu 2
                '0.45',            // Câu 3
                '0.29',         // Câu 4
                '(a căn 15) / 5', // Câu 5 
                '(3 căn 3) / 2', // Câu 6
                '1 / 4', // Câu 7
                '0.708', // Câu 8
            ]
        },
        'toan12-gk1-001': {
            multipleChoice: [
                'B', 'A', 'A', 'A', 'B', 'A', 'C', 'C', 'D', 'D',
                'D', 'C'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Sai'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 3: a,b,c,d
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 4: a,b,c,d
               
                
            ],
            shortAnswer: [
                '4',          // Câu 1
                '-5',           // Câu 2
                '6',            // Câu 3
                '5',         // Câu 4
                '35', // Câu 5 
                '14', // Câu 6
                '112 độ 26 phút 16 giây', // Câu 7
            ]
        },
        'toan12-gk1-002': {
            multipleChoice: [
                'A', 'D', 'A', 'C', 'C', 'C', 'A', 'B', 'D', 'D',
                'B', 'C'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Đúng'],
                ['Sai', 'Sai', 'Đúng', 'Đúng'],
                ['Đúng', 'Sai', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '-6', '4', '1', '3.6', '5.8', '21', '-6', '4'
            ]
        },
        'toan12-gk1-003': {
            multipleChoice: [
                'B', 'A', 'A', 'A', 'B', 'A', 'C', 'C', 'D', 'D',
                'D', 'C'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Sai'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 3: a,b,c,d
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 4: a,b,c,d
               
                
            ],
            shortAnswer: [
                '4',          // Câu 1
                '-5',           // Câu 2
                '6',            // Câu 3
                '5',         // Câu 4
                '35', // Câu 5 
                '14', // Câu 6
                '112 độ 26 phút 16 giây', // Câu 7
            ]
        },
        'toan12-gk1-004': {
            multipleChoice: [
                'B', 'A', 'A', 'A', 'B', 'A', 'C', 'C', 'D', 'D',
                'D', 'C'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Sai'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 3: a,b,c,d
                ['Đúng', 'Đúng', 'Sai', 'Đúng'], // Câu 4: a,b,c,d
               
                
            ],
            shortAnswer: [
                '4',          // Câu 1
                '-5',           // Câu 2
                '6',            // Câu 3
                '5',         // Câu 4
                '35', // Câu 5 
                '14', // Câu 6
                '112 độ 26 phút 16 giây', // Câu 7
            ]
        },
        'toan12-ck1-001': {
            multipleChoice: [
                'A', 'A', 'D', 'D', 'D', 'D', 'C', 'D', 'B', 'A',
                'D', 'D'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 3: a,b,c,d
              
               
                
            ],
            shortAnswer: [
                '8',          // Câu 1
                '22.2',           // Câu 2
                '2.5',            // Câu 3
                '36',         // Câu 4
                '-1;1', // Câu 5 
                'căn 11', // Câu 6
                'căn 2 / 2', // Câu 7
                '20' , // câu 8
            ]
        },
        'toan12-ck1-002': {
            multipleChoice: [
                'A', 'B', 'A', 'A', 'B', 'A', 'B', 'C', 'B', 'B',
                'C', 'A'
            ],
            trueFalse: [
                ['Sai', 'Đúng', 'Đúng', 'Đúng'],
                ['Đúng', 'Đúng', 'Sai', 'Đúng']
            ],
            shortAnswer: [
                '2', '165', '8.13', '4', '3/14;-6/7;0', '11', '5.89' 
            ]
        },
        'toan12-ck1-003': {
            multipleChoice: [
                'A', 'A', 'D', 'D', 'D', 'D', 'C', 'D', 'B', 'A',
                'D', 'D'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 3: a,b,c,d
              
               
                
            ],
            shortAnswer: [
                '8',          // Câu 1
                '22.2',           // Câu 2
                '2.5',            // Câu 3
                '36',         // Câu 4
                '-1;1', // Câu 5 
                'căn 11', // Câu 6
                'căn 2 / 2', // Câu 7
                '20' , // câu 8
            ]
        },
        'toan12-ck1-004': {
            multipleChoice: [
                'A', 'A', 'D', 'D', 'D', 'D', 'C', 'D', 'B', 'A',
                'D', 'D'
            ],
            trueFalse: [
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
                ['Đúng', 'Sai', 'Đúng', 'Sai'], // Câu 3: a,b,c,d
              
               
                
            ],
            shortAnswer: [
                '8',          // Câu 1
                '22.2',           // Câu 2
                '2.5',            // Câu 3
                '36',         // Câu 4
                '-1;1', // Câu 5 
                'căn 11', // Câu 6
                'căn 2 / 2', // Câu 7
                '20' , // câu 8
            ]
        },
        'toan12-gk2-001': {
            multipleChoice: [
                'D', 'B', 'A', 'D', 'A', 'A', 'B', 'A', 'C', 'A',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '7',          // Câu 1
                '6.4',           // Câu 2
                '4.5',            // Câu 3
                '2',         // Câu 4
                
            ]
        },
        'toan12-gk2-002': {
            multipleChoice: [
                'A', 'A', 'B', 'B', 'D', 'C', 'C', 'B', 'A', 'B',
                'A', 'D'
            ],
            trueFalse: [
                ['Sai', 'Đúng', 'Đúng', 'Đúng'],
                ['Đúng', 'Sai', 'Đúng', 'Sai']
            ],
            shortAnswer: [
                '12', '6', '21', '3.4', '6.6', '630'
            ]
        },
        'toan12-gk2-003': {
            multipleChoice: [
                'D', 'B', 'A', 'D', 'A', 'A', 'B', 'A', 'C', 'A',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '7',          // Câu 1
                '6.4',           // Câu 2
                '4.5',            // Câu 3
                '2',         // Câu 4
                
            ]
        },
        'toan12-gk2-004': {
            multipleChoice: [
                'D', 'B', 'A', 'D', 'A', 'A', 'B', 'A', 'C', 'A',
                'A', 'D'
            ],
            trueFalse: [
                ['Đúng', 'Đúng', 'Sai', 'Sai'], // Câu 1: a,b,c,d
                ['Sai', 'Sai', 'Đúng', 'Đúng'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '7',          // Câu 1
                '6.4',           // Câu 2
                '4.5',            // Câu 3
                '2',         // Câu 4
                
            ]
        },
        'toan12-ck2-001': {
            multipleChoice: [
                'D', 'A', 'D', 'B', 'B', 'A', 'A', 'B', 'C', 'B',
                'C', 'B'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Sai', 'Đúng', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '46',          // Câu 1
                '-9',           // Câu 2
                '44',            // Câu 3
                '-1',         // Câu 4
                
            ]
        },
        'toan12-ck2-002': {
            multipleChoice: [
                'C', 'A', 'C', 'D', 'D', 'D', 'A', 'A', 'D', 'A',
                'C', 'B'
            ],
            trueFalse: [
                ['Sai', 'Đúng', 'Đúng', 'Sai'],
                ['Đúng', 'Sai', 'Đúng', 'Đúng']
            ],
            shortAnswer: [
                '7', '19', '38', '0.6', '4275', '0.73'
            ]
        },
        'toan12-ck2-003': {
            multipleChoice: [
                'D', 'A', 'D', 'B', 'B', 'A', 'A', 'B', 'C', 'B',
                'C', 'B'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Sai', 'Đúng', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '46',          // Câu 1
                '-9',           // Câu 2
                '44',            // Câu 3
                '-1',         // Câu 4
                
            ]
        },
        'toan12-ck2-004': {
            multipleChoice: [
                'D', 'A', 'D', 'B', 'B', 'A', 'A', 'B', 'C', 'B',
                'C', 'B'
            ],
            trueFalse: [
                ['Đúng', 'Sai', 'Đúng', 'Đúng'], // Câu 1: a,b,c,d
                ['Sai', 'Đúng', 'Đúng', 'Sai'], // Câu 2: a,b,c,d
               
                
            ],
            shortAnswer: [
                '46',          // Câu 1
                '-9',           // Câu 2
                '44',            // Câu 3
                '-1',         // Câu 4
                
            ]
        },
        
        
    };
    
    // Hàm hiển thị/ẩn mã đề khi click vào kỳ thi
    function toggleExamCodes(examId) {
        // Ẩn tất cả các danh sách mã đề
        const allCodeLists = document.querySelectorAll('.exam-codes');
        allCodeLists.forEach(list => {
            list.classList.remove('active');
        });
        
        // Hiển thị danh sách mã đề được chọn
        const selectedList = document.getElementById(`${examId}-codes`);
        if (selectedList) {
            selectedList.classList.toggle('active');
        }
    }
    
    // Hàm chọn mã đề
function selectExamCode(examId, code) {
    // Kiểm tra nếu là đề số 3 hoặc 4 - áp dụng cho mọi kỳ thi
    if (code === '003' || code === '004') {
        alert('Xin lỗi người dùng, hệ thống sẽ cập nhật đề này sớm nhất');
        // Ẩn tất cả các danh sách mã đề
        const allCodeLists = document.querySelectorAll('.exam-codes');
        allCodeLists.forEach(list => {
            list.classList.remove('active');
        });
        return; // Dừng hàm, không thực hiện tiếp
    }
    
    selectedExam = examId;
    selectedExamCode = code;
    
    // Lấy tên đề thi đầy đủ
    let examFullName = getExamName(examId);
    
    // Hiển thị thông tin lựa chọn
    document.getElementById('selected-exam-name').textContent = examFullName;
    document.getElementById('selected-exam-code').textContent = `Đề số ${code}`;
    document.getElementById('exam-selection').style.display = 'block';
    
    // Ẩn tất cả các danh sách mã đề
    const allCodeLists = document.querySelectorAll('.exam-codes');
    allCodeLists.forEach(list => {
        list.classList.remove('active');
    });
    
    // Cuộn đến phần chọn đề thi
    document.getElementById('exam-selection').scrollIntoView({ behavior: 'smooth' });
}
    
    // Hàm lấy tên đề thi
    function getExamName(examId) {
        const examNames = {
            'toan10-gk1-001': 'Toán 10 - Đề kiểm tra giữa kỳ 1 Đề số 1',
            'toan10-gk1-002': 'Toán 10 - Đề kiểm tra giữa kỳ 1 Đề số 2',
            'toan10-gk1-003': 'Toán 10 - Đề kiểm tra giữa kỳ 1 Đề số 3',
            'toan10-ck1-004': 'Toán 10 - Đề kiểm tra cuối kỳ 1 Đề số 4',
            'toan10-gk2-001': 'Toán 10 - Đề kiểm tra giữa kỳ 2 Đề số 1',
            'toan10-gk2-002': 'Toán 10 - Đề kiểm tra giữa kỳ 2 Đề số 2',
            'toan10-gk2-003': 'Toán 10 - Đề kiểm tra giữa kỳ 2 Đề số 3',
            'toan10-gk2-004': 'Toán 10 - Đề kiểm tra giữa kỳ 2 Đề số 4',
            'toan10-ck2-001': 'Toán 10 - Đề kiểm tra cuối kỳ 2 Đề số 1',
            'toan10-ck2-002': 'Toán 10 - Đề kiểm tra cuối kỳ 2 Đề số 2',
            'toan10-ck2-003': 'Toán 10 - Đề kiểm tra cuối kỳ 2 Đề số 3',
            'toan10-ck2-004': 'Toán 10 - Đề kiểm tra cuối kỳ 2 Đề số 4',
            'toan11-gk1-001': 'Toán 11 - Đề kiểm tra giữa kỳ 1 Đề số 1',
            'toan11-gk1-002': 'Toán 11 - Đề kiểm tra giữa kỳ 1 Đề số 2',
            'toan11-gk1-003': 'Toán 11 - Đề kiểm tra giữa kỳ 1 Đề số 3',
            'toan11-gk1-004': 'Toán 11 - Đề kiểm tra giữa kỳ 1 Đề số 4',
            'toan11-ck1-001': 'Toán 11 - Đề kiểm tra cuối kỳ 1 Đề số 1',
            'toan11-ck1-002': 'Toán 11 - Đề kiểm tra cuối kỳ 1 Đề số 2',
            'toan11-ck1-003': 'Toán 11 - Đề kiểm tra cuối kỳ 1 Đề số 3',
            'toan11-ck1-004': 'Toán 11 - Đề kiểm tra cuối kỳ 1 Đề số 4',
            'toan11-gk2-001': 'Toán 11 - Đề kiểm tra giữa kỳ 2 Đề số 1',
            'toan11-gk2-002': 'Toán 11 - Đề kiểm tra giữa kỳ 2 Đề số 2',
            'toan11-gk2-003': 'Toán 11 - Đề kiểm tra giữa kỳ 2 Đề số 3',
            'toan11-gk2-004': 'Toán 11 - Đề kiểm tra giữa kỳ 2 Đề số 4',
            'toan11-ck2-001': 'Toán 11 - Đề kiểm tra cuối kỳ 2 Đề số 1',
            'toan11-ck2-002': 'Toán 11 - Đề kiểm tra cuối kỳ 2 Đề số 2',
            'toan11-ck2-003': 'Toán 11 - Đề kiểm tra cuối kỳ 2 Đề số 3',
            'toan11-ck2-004': 'Toán 11 - Đề kiểm tra cuối kỳ 2 Đề số 4',
            'toan12-gk1-001': 'Toán 12 - Đề kiểm tra giữa kỳ 1 Đề số 1',
            'toan12-gk1-002': 'Toán 12 - Đề kiểm tra giữa kỳ 1 Đề số 2',
            'toan12-gk1-003': 'Toán 12 - Đề kiểm tra giữa kỳ 1 Đề số 3',
            'toan12-gk1-004': 'Toán 12 - Đề kiểm tra giữa kỳ 1 Đề số 4',
            'toan12-ck1-001': 'Toán 12 - Đề kiểm tra cuối kỳ 1 Đề số 1',
            'toan12-ck1-002': 'Toán 12 - Đề kiểm tra cuối kỳ 1 Đề số 2',
            'toan12-ck1-003': 'Toán 12 - Đề kiểm tra cuối kỳ 1 Đề số 3',
            'toan12-ck1-004': 'Toán 12 - Đề kiểm tra cuối kỳ 1 Đề số 4',
            'toan12-gk2-001': 'Toán 12 - Đề kiểm tra giữa kỳ 2 Đề số 1',
            'toan12-gk2-002': 'Toán 12 - Đề kiểm tra giữa kỳ 2 Đề số 2',
            'toan12-gk2-003': 'Toán 12 - Đề kiểm tra giữa kỳ 2 Đề số 3',
            'toan12-gk2-004': 'Toán 12 - Đề kiểm tra giữa kỳ 2 Đề số 4',
            'toan12-ck2-001': 'Toán 12 - Đề kiểm tra cuối kỳ 2 Đề số 1',
            'toan12-ck2-002': 'Toán 12 - Đề kiểm tra cuối kỳ 2 Đề số 2',
            'toan12-ck2-003': 'Toán 12 - Đề kiểm tra cuối kỳ 2 Đề số 3',
            'toan12-ck2-004': 'Toán 12 - Đề kiểm tra cuối kỳ 2 Đề số 4',
        };
        
        return examNames[examId] || 'Đề kiểm tra';
    }
    
    // Hàm bắt đầu làm bài thi
    function startExam() {
        document.getElementById('exam-selection').style.display = 'none';
        document.getElementById('exam-container').style.display = 'block';
        
        // Reset các biến theo dõi
        isExamActive = true;
        violationCount = 0;
        cheatDetected = false;
        lastFocusTime = Date.now();
        visibilityWarningShown = false;
        
        // Ẩn các thông báo vi phạm
        document.getElementById('cheat-detected-message').style.display = 'none';
        document.getElementById('warning-message').style.display = 'none';
        document.getElementById('warning-count').textContent = '0';
        
        // Hiển thị đề thi
        document.getElementById('exam-title').textContent = `${getExamName(selectedExam)} - Đề số ${selectedExamCode}`;
        document.getElementById('exam-description').innerHTML = generateExamContent(selectedExam, selectedExamCode);
        
        // Khởi tạo câu hỏi mẫu
        generateSampleQuestions();
        
        // Bắt đầu đếm ngược
        startTimer();
        
        // Bắt đầu theo dõi hành vi gian lận
        startCheatDetection();
        
        // Tự động vào chế độ fullscreen
        setTimeout(() => {
            toggleFullscreen();
        }, 500);
        
        // Cuộn đến phần làm bài
        document.getElementById('exam-container').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Hàm tạo nội dung đề thi
    function generateExamContent(examId, examCode) {
        // Tạo URL Google Drive cho đề thi
        let driveUrl = '';
        
        switch(examId) {
            case 'toan10-gk1':
                if (examCode === '001') {
                    driveUrl = 'https://drive.google.com/file/d/1CbILHvTTWRPLcZpkDLOkxOifxhNctHbG/preview';
                } else if (examCode === '002'){
                    driveUrl = 'https://drive.google.com/file/d/1I2ACqqdeC7xWiTC3ljE9DCL6TvtoeIAk/preview';
                } else if (examCode === '003'){
                    driveUrl = 'https://drive.google.com/file/d/1CbILHvTTWRPLcZpkDLOkxOifxhNctHbG/preview';
                } else if (examCode === '004'){
                    driveUrl = 'https://drive.google.com/file/d/1CbILHvTTWRPLcZpkDLOkxOifxhNctHbG/preview';
                }
                break;
            case 'toan10-ck1':
                if (examCode === '001') {
                    driveUrl = 'https://drive.google.com/file/d/1GCq_4NC1DemeTJ-qC3TaS4A-dg5si2_5/preview';
                } else if (examCode === '002') {
                    driveUrl = 'https://drive.google.com/file/d/1s9CguQv2NIHXcucKYmG0jx-ALepjdBwK/preview';
                } else if (examCode === '003') {
                    driveUrl = 'https://drive.google.com/file/d/1GCq_4NC1DemeTJ-qC3TaS4A-dg5si2_5/preview';
                } else if (examCode === '003') {
                    driveUrl = 'https://drive.google.com/file/d/1GCq_4NC1DemeTJ-qC3TaS4A-dg5si2_5/preview';
                } 
                break;
            case 'toan10-gk2':
                if (examCode === '001') {
                driveUrl = 'https://drive.google.com/file/d/1w2Pt5ktO-ADS8gOkfXzdhXMdft4sNTQL/preview';
                } else if (examCode === '002') {
                driveUrl = 'https://drive.google.com/file/d/10FXNVipsgTuGuoA6GwBBZQd1rmmtEUz4/preview';
                } else if (examCode === '003') {
                driveUrl = 'https://drive.google.com/file/d/1w2Pt5ktO-ADS8gOkfXzdhXMdft4sNTQL/preview';
                } else if (examCode === '004') {
                driveUrl = 'https://drive.google.com/file/d/1w2Pt5ktO-ADS8gOkfXzdhXMdft4sNTQL/preview';
                }
                break;
            case 'toan10-ck2':
                if (examCode ==='001'){
                driveUrl = 'https://drive.google.com/file/d/1w48m6IyLmF9suq3vAlZwagV3L-8zlhtx/preview';
                } else if (examCode ==='002'){
                driveUrl = 'https://drive.google.com/file/d/1Cu7dTyZJg_YF0GU-970TamFFCZhBBjTT/preview';
                } else if (examCode ==='003'){
                driveUrl = 'https://drive.google.com/file/d/1w48m6IyLmF9suq3vAlZwagV3L-8zlhtx/preview';
                } else if (examCode ==='004'){
                driveUrl = 'https://drive.google.com/file/d/1w48m6IyLmF9suq3vAlZwagV3L-8zlhtx/preview';
                }
                break;
            case 'toan11-gk1':
                if (examCode === '001'){
                driveUrl = 'https://drive.google.com/file/d/1lepuGPnF-zv4eUClL-SeqKP5-7YwbKDd/preview';
                } else if (examCode === '002'){
                driveUrl = 'https://drive.google.com/file/d/13QF_cNflh1XZMHa_Z6dxR_t425ZLKTE1/preview';
                } else if (examCode === '003'){
                driveUrl = 'https://drive.google.com/file/d/1lepuGPnF-zv4eUClL-SeqKP5-7YwbKDd/preview';
                } else if (examCode === '004'){
                driveUrl = 'https://drive.google.com/file/d/1lepuGPnF-zv4eUClL-SeqKP5-7YwbKDd/preview';
                }
                break;
            case 'toan11-ck1':
                if (examCode ==='001'){
                driveUrl = 'https://drive.google.com/file/d/1gz0pzpAu7XaXwgDILZ8FHh7vu7SI8VWj/preview';
                } else if (examCode ==='002'){
                driveUrl = 'https://drive.google.com/file/d/1fbpPPSWv4z2Ep7zryEoOtjG2djd19J_2/preview';
                } else if (examCode ==='003'){
                driveUrl = 'https://drive.google.com/file/d/1gz0pzpAu7XaXwgDILZ8FHh7vu7SI8VWj/preview';
                } else if (examCode ==='004'){
                driveUrl = 'https://drive.google.com/file/d/1gz0pzpAu7XaXwgDILZ8FHh7vu7SI8VWj/preview';
                }
                break;
            case 'toan11-gk2':
                if (examCode === '001'){
                driveUrl = 'https://drive.google.com/file/d/1O9yoHW_UyeHIaJk4LwhgtuuRhxUhe0Uj/preview';
                } else if (examCode === '002'){
                driveUrl = 'https://drive.google.com/file/d/1Wze8Wa9A3Ji7ehF_boV_NSzJ98kTtxMW/preview';
                } else if (examCode === '003'){
                driveUrl = 'https://drive.google.com/file/d/1O9yoHW_UyeHIaJk4LwhgtuuRhxUhe0Uj/preview';
                } else if (examCode === '004'){
                driveUrl = 'https://drive.google.com/file/d/1O9yoHW_UyeHIaJk4LwhgtuuRhxUhe0Uj/preview';
                }
                break;
            case 'toan11-ck2':
                if (examCode ==='001'){
                driveUrl = 'https://drive.google.com/file/d/1lIip-UB3k62EWrHsE8Kmjo7SLsqww1Fu/preview';
                } else if (examCode ==='002'){
                driveUrl = 'https://drive.google.com/file/d/17iJKjEueJDlYn1mooPxAuB1plrhmPX2M/preview';
                } else if (examCode ==='003'){
                driveUrl = 'https://drive.google.com/file/d/1lIip-UB3k62EWrHsE8Kmjo7SLsqww1Fu/preview';
                } else if (examCode ==='004'){
                driveUrl = 'https://drive.google.com/file/d/1lIip-UB3k62EWrHsE8Kmjo7SLsqww1Fu/preview';
                }
                break;
            case 'toan12-gk1':
                if (examCode === '001'){
                driveUrl = 'https://drive.google.com/file/d/1u3w5el0Xb9VeP6OzBP7BXgUGQGU7TTJH/preview';
                } else if (examCode === '002'){
                driveUrl = 'https://drive.google.com/file/d/14J2GEW-w8RTAu2qmsh7da_Cd00SsD9o1/preview';
                } else if (examCode === '003'){
                driveUrl = 'https://drive.google.com/file/d/1u3w5el0Xb9VeP6OzBP7BXgUGQGU7TTJH/preview';
                } else if (examCode === '004'){
                driveUrl = 'https://drive.google.com/file/d/1u3w5el0Xb9VeP6OzBP7BXgUGQGU7TTJH/preview';
                }
                break;
            case 'toan12-ck1':
                if (examCode ==='001'){
                driveUrl = 'https://drive.google.com/file/d/1TCJYHNIdAp6z2oGVocecUhkg4rIgyeVB/preview';
                } else if (examCode ==='002'){
                driveUrl = 'https://drive.google.com/file/d/1Pu1UcCxxQKXjxuXQ0Tw6voS0-356CGoc/preview';
                } else if (examCode ==='003'){
                driveUrl = 'https://drive.google.com/file/d/1TCJYHNIdAp6z2oGVocecUhkg4rIgyeVB/preview';
                } else if (examCode ==='004'){
                driveUrl = 'https://drive.google.com/file/d/1TCJYHNIdAp6z2oGVocecUhkg4rIgyeVB/preview';
                }
                break;
            case 'toan12-gk2':
                if (examCode ==='001'){
                driveUrl = 'https://drive.google.com/file/d/1kf7edmUHo8mHXv1rq-nNAbLXSlgvaki6/preview';
                } else if (examCode ==='002'){
                driveUrl = 'https://drive.google.com/file/d/1FIC-zGhrzblfprxmeedDxzSzhuSuVAXv/preview';
                } else if (examCode ==='003'){
                driveUrl = 'https://drive.google.com/file/d/1kf7edmUHo8mHXv1rq-nNAbLXSlgvaki6/preview';
                } else if (examCode ==='004'){
                driveUrl = 'https://drive.google.com/file/d/1kf7edmUHo8mHXv1rq-nNAbLXSlgvaki6/preview';
                }
                break;
            case 'toan12-ck2':
                if (examCode === '001'){
                driveUrl = 'https://drive.google.com/file/d/1FG8b1RfMiVGttph2qssqh8MkoC2H_742/preview';
                } else if (examCode === '002'){
                driveUrl = 'https://drive.google.com/file/d/1rlShabMc3pgzpe2s1RH5iLmwXcYRBA-X/preview';
                } else if (examCode === '003'){
                driveUrl = 'https://drive.google.com/file/d/1FG8b1RfMiVGttph2qssqh8MkoC2H_742/preview';
                } else if (examCode === '004'){
                driveUrl = 'https://drive.google.com/file/d/1FG8b1RfMiVGttph2qssqh8MkoC2H_742/preview';
                }
                break;
        }
        
        return `
            <div class="exam-instructions">
                <p><strong>Thời gian làm bài: 60 phút</strong></p>
                <p><strong>Hình thức kiểm tra: Trắc nghiệm kết hợp tự luận</strong></p>
                <p><strong>Đề: ${examCode}</strong></p>
                <p><strong>Hướng dẫn chung:</strong></p>
                <ul>
                    <li>Phần A: Trắc nghiệm nhiều lựa chọn (12 câu × 0.25 điểm = 3 điểm)</li>
                    <li>Phần B: Trắc nghiệm đúng/sai (3 câu × 1 điểm = 3 điểm)</li>
                    <li>Phần C: Trả lời ngắn (8 câu × 0.5 điểm = 4 điểm)</li>
                    <li>Tổng điểm: 10 điểm</li>
                    <li>Thí sinh không được sử dụng tài liệu</li>
                    <li>Điền đáp án vào đúng vị trí quy định</li>
                </ul>
                <p style="color: #e74c3c; font-weight: bold;">
                    ⚠️ CẢNH BÁO: Hệ thống có tính năng chống gian lận. 
                    Nếu bạn rời khỏi màn hình kiểm tra hoặc chuyển tab, bài kiểm tra sẽ bị hủy với 0 điểm!
                </p>
            </div>
            <p><strong>Đề kiểm tra:</strong></p>
            <div class="exam-frame-container">
                <iframe src="${driveUrl}" 
                        class="exam-frame" 
                        allow="autoplay">
                </iframe>
            </div>
        `;
    }
    
    // Hàm tạo câu hỏi mẫu
    // Hàm tạo câu hỏi mẫu - SỬA ĐỂ TẠO ĐÚNG SỐ CÂU HỎI THEO TỪNG ĐỀ
function generateSampleQuestions() {
    const multipleChoiceContainer = document.getElementById('multiple-choice-questions');
    const trueFalseContainer = document.getElementById('true-false-questions');
    const shortAnswerContainer = document.getElementById('short-answer-questions');
    
    // Xóa nội dung cũ
    multipleChoiceContainer.innerHTML = '';
    trueFalseContainer.innerHTML = '';
    shortAnswerContainer.innerHTML = '';
    
    // Lấy đáp án cho đề thi hiện tại
    const answerKey = examAnswers[`${selectedExam}-${selectedExamCode}`];
    
    if (!answerKey) {
        console.log(`Không tìm thấy đáp án cho đề số: ${selectedExam}-${selectedExamCode}`);
        return;
    }
    
    // Tạo câu hỏi trắc nghiệm nhiều lựa chọn (luôn 12 câu)
    for (let i = 1; i <= 12; i++) {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question';
        
        questionDiv.innerHTML = `
            <div class="question-title">Câu ${i}: Chọn đáp án đúng:</div>
            <div class="options">
                <div class="option">
                    <input type="radio" id="q${i}_a" name="q${i}" value="A">
                    <label for="q${i}_a">A</label>
                </div>
                <div class="option">
                    <input type="radio" id="q${i}_b" name="q${i}" value="B">
                    <label for="q${i}_b">B</label>
                </div>
                <div class="option">
                    <input type="radio" id="q${i}_c" name="q${i}" value="C">
                    <label for="q${i}_c">C</label>
                </div>
                <div class="option">
                    <input type="radio" id="q${i}_d" name="q${i}" value="D">
                    <label for="q${i}_d">D</label>
                </div>
            </div>
        `;
        
        multipleChoiceContainer.appendChild(questionDiv);
    }
    
    // Tạo câu hỏi trắc nghiệm đúng/sai - SỬA: TẠO ĐÚNG SỐ CÂU THEO ĐÁP ÁN
    const trueFalseCount = answerKey.trueFalse ? answerKey.trueFalse.length : 0;
    for (let i = 1; i <= trueFalseCount; i++) {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question';
        
        questionDiv.innerHTML = `
            <div class="question-title">Câu ${i}: Xác định tính đúng/sai của các phát biểu:</div>
            <div class="options">
                <div class="option">
                    <input type="radio" id="tf${i}_a_true" name="tf${i}_a" value="Đúng">
                    <label for="tf${i}_a_true">a) Đúng</label>
                    <input type="radio" id="tf${i}_a_false" name="tf${i}_a" value="Sai">
                    <label for="tf${i}_a_false">a) Sai</label>
                </div>
                <div class="option">
                    <input type="radio" id="tf${i}_b_true" name="tf${i}_b" value="Đúng">
                    <label for="tf${i}_b_true">b) Đúng</label>
                    <input type="radio" id="tf${i}_b_false" name="tf${i}_b" value="Sai">
                    <label for="tf${i}_b_false">b) Sai</label>
                </div>
                <div class="option">
                    <input type="radio" id="tf${i}_c_true" name="tf${i}_c" value="Đúng">
                    <label for="tf${i}_c_true">c) Đúng</label>
                    <input type="radio" id="tf${i}_c_false" name="tf${i}_c" value="Sai">
                    <label for="tf${i}_c_false">c) Sai</label>
                </div>
                <div class="option">
                    <input type="radio" id="tf${i}_d_true" name="tf${i}_d" value="Đúng">
                    <label for="tf${i}_d_true">d) Đúng</label>
                    <input type="radio" id="tf${i}_d_false" name="tf${i}_d" value="Sai">
                    <label for="tf${i}_d_false">d) Sai</label>
                </div>
            </div>
        `;
        
        trueFalseContainer.appendChild(questionDiv);
    }
    
    // Cập nhật tiêu đề phần đúng/sai với số câu thực tế
    if (trueFalseContainer.parentNode.querySelector('h3')) {
        trueFalseContainer.parentNode.querySelector('h3').textContent = 
            `B. Trắc nghiệm đúng/sai (${trueFalseCount} câu × 1 điểm = ${trueFalseCount} điểm)`;
    }
    
    // Tạo câu hỏi trả lời ngắn - SỬA: TẠO ĐÚNG SỐ CÂU THEO ĐÁP ÁN
    const shortAnswerCount = answerKey.shortAnswer ? answerKey.shortAnswer.length : 0;
    for (let i = 1; i <= shortAnswerCount; i++) {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question';
        
        questionDiv.innerHTML = `
            <div class="question-title">Câu ${i}: Nhập đáp án:</div>
            <input type="text" class="short-answer" id="sa${i}" placeholder="Nhập đáp án...">
        `;
        
        shortAnswerContainer.appendChild(questionDiv);
    }
    
    // Cập nhật tiêu đề phần trả lời ngắn với số câu thực tế
    if (shortAnswerContainer.parentNode.querySelector('h3')) {
        const saPoints = shortAnswerCount * 0.5;
        shortAnswerContainer.parentNode.querySelector('h3').textContent = 
            `C. Trả lời ngắn (${shortAnswerCount} câu × 0.5 điểm = ${saPoints} điểm)`;
    }
}

// Hàm tính điểm chi tiết - SỬA ĐỂ TÍNH ĐÚNG THEO SỐ CÂU THỰC TẾ
function calculateDetailedScores() {
    let mcScore = 0;
    let tfScore = 0;
    let saScore = 0;
    
    const answerKey = examAnswers[`${selectedExam}-${selectedExamCode}`];
    
    if (!answerKey) {
        // Nếu không có đáp án cho mã đề này, trả về điểm 0
        console.log(`Không tìm thấy đáp án cho đề số: ${selectedExam}-${selectedExamCode}`);
        return { mcScore, tfScore, saScore, totalScore: 0 };
    }
    
    // Tính điểm phần trắc nghiệm nhiều lựa chọn (luôn 12 câu)
    for (let i = 1; i <= 12; i++) {
        const selectedAnswer = document.querySelector(`input[name="q${i}"]:checked`);
        if (selectedAnswer && selectedAnswer.value === answerKey.multipleChoice[i-1]) {
            mcScore += 0.25;
        }
    }
    
    // Tính điểm phần trắc nghiệm đúng/sai - SỬA: TÍNH ĐÚNG SỐ CÂU THỰC TẾ
    const trueFalseCount = answerKey.trueFalse ? answerKey.trueFalse.length : 0;
    for (let i = 1; i <= trueFalseCount; i++) {
        const correctAnswers = answerKey.trueFalse[i-1];
        
        // Kiểm tra 4 ý con trong mỗi câu
        const subQuestions = ['a', 'b', 'c', 'd'];
        subQuestions.forEach((sub, index) => {
            const selectedAnswer = document.querySelector(`input[name="tf${i}_${sub}"]:checked`);
            if (selectedAnswer && selectedAnswer.value === correctAnswers[index]) {
                tfScore += 0.25; // Mỗi ý đúng được 0.25 điểm
            }
        });
    }
    
    // Tính điểm phần trả lời ngắn - SỬA: TÍNH ĐÚNG SỐ CÂU THỰC TẾ
    const shortAnswerCount = answerKey.shortAnswer ? answerKey.shortAnswer.length : 0;
    for (let i = 1; i <= shortAnswerCount; i++) {
        const userAnswer = document.getElementById(`sa${i}`).value.trim();
        const correctAnswer = answerKey.shortAnswer[i-1];
        
        // So sánh đáp án (có thể thêm logic chuẩn hóa nếu cần)
        if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
            saScore += 0.5;
        }
    }
    
    const totalScore = mcScore + tfScore + saScore;
    return { mcScore, tfScore, saScore, totalScore };
}

// Hàm hiển thị đánh giá chi tiết - SỬA ĐỂ HIỂN THỊ ĐÚNG SỐ CÂU
function showAnswerReview(scores) {
    const answerDetails = document.getElementById('answer-details');
    answerDetails.innerHTML = '';
    
    const answerKey = examAnswers[`${selectedExam}-${selectedExamCode}`];
    
    if (!answerKey) {
        answerDetails.innerHTML = '<p>Không có thông tin đáp án cho đề này.</p>';
        return;
    }
    
    // Hiển thị đáp án phần trắc nghiệm nhiều lựa chọn
    let mcReview = '<h4>Phần A: Trắc nghiệm nhiều lựa chọn (3 điểm)</h4>';
    for (let i = 1; i <= 12; i++) {
        const selectedAnswer = document.querySelector(`input[name="q${i}"]:checked`);
        const userAnswer = selectedAnswer ? selectedAnswer.value : 'Chưa chọn';
        const correctAnswer = answerKey.multipleChoice[i-1];
        const isCorrect = userAnswer === correctAnswer;
        
        mcReview += `<p><strong>Câu ${i}:</strong> `;
        mcReview += `<span class="user-answer">${userAnswer}</span> `;
        if (isCorrect) {
            mcReview += `<span class="correct-answer">(Đúng)</span>`;
        } else {
            mcReview += `<span class="wrong-answer">(Sai) → Đáp án đúng: <span class="correct-answer">${correctAnswer}</span></span>`;
        }
        mcReview += '</p>';
    }
    
    // Hiển thị đáp án phần đúng/sai - SỬA: HIỂN THỊ ĐÚNG SỐ CÂU
    let tfReview = '<h4>Phần B: Trắc nghiệm đúng/sai</h4>';
    const trueFalseCount = answerKey.trueFalse ? answerKey.trueFalse.length : 0;
    for (let i = 1; i <= trueFalseCount; i++) {
        const correctAnswers = answerKey.trueFalse[i-1];
        tfReview += `<p><strong>Câu ${i}:</strong></p><ul>`;
        
        const subQuestions = ['a', 'b', 'c', 'd'];
        subQuestions.forEach((sub, index) => {
            const selectedAnswer = document.querySelector(`input[name="tf${i}_${sub}"]:checked`);
            const userAnswer = selectedAnswer ? selectedAnswer.value : 'Chưa chọn';
            const correctAnswer = correctAnswers[index];
            const isCorrect = userAnswer === correctAnswer;
            
            tfReview += `<li>Ý ${sub}: `;
            tfReview += `<span class="user-answer">${userAnswer}</span> `;
            if (isCorrect) {
                tfReview += `<span class="correct-answer">(Đúng)</span>`;
            } else {
                tfReview += `<span class="wrong-answer">(Sai) → Đáp án đúng: <span class="correct-answer">${correctAnswer}</span></span>`;
            }
            tfReview += '</li>';
        });
        tfReview += '</ul>';
    }
    
    // Hiển thị đáp án phần trả lời ngắn - SỬA: HIỂN THỊ ĐÚNG SỐ CÂU
    let saReview = '<h4>Phần C: Trả lời ngắn</h4>';
    const shortAnswerCount = answerKey.shortAnswer ? answerKey.shortAnswer.length : 0;
    for (let i = 1; i <= shortAnswerCount; i++) {
        const userAnswer = document.getElementById(`sa${i}`).value.trim();
        const correctAnswer = answerKey.shortAnswer[i-1];
        const isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();
        
        saReview += `<p><strong>Câu ${i}:</strong> `;
        saReview += `<span class="user-answer">${userAnswer || 'Chưa trả lời'}</span> `;
        if (isCorrect) {
            saReview += `<span class="correct-answer">(Đúng)</span>`;
        } else {
            saReview += `<span class="wrong-answer">(Sai) → Đáp án đúng: <span class="correct-answer">${correctAnswer}</span></span>`;
        }
        saReview += '</p>';
    }
    
    answerDetails.innerHTML = mcReview + tfReview + saReview;
}
    
    // Hàm bắt đầu đếm ngược
    function startTimer() {
        updateTimerDisplay();
        
        timerInterval = setInterval(function() {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitExam();
            }
        }, 1000);
    }
    
    // Hàm cập nhật hiển thị thời gian
    function updateTimerDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('timer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // Hàm nộp bài
    function submitExam() {
        clearInterval(timerInterval);
        isExamActive = false;
        
        // Thoát khỏi chế độ fullscreen trước
        if (isFullscreen) {
            exitFullscreen();
        }
        
        // Ẩn phần làm bài, hiển thị kết quả
        document.getElementById('exam-container').style.display = 'none';
        document.getElementById('result-container').style.display = 'block';
        
        // Tính điểm
        const scores = calculateDetailedScores();
        const totalScore = cheatDetected ? 0 : scores.totalScore;
        
        // Hiển thị kết quả
        if (cheatDetected) {
            document.getElementById('score').textContent = `0/10`;
            document.getElementById('score').className = 'score score-zero';
            document.getElementById('result-details').textContent = 
                `Bài kiểm tra ${getExamName(selectedExam)} - Đề ${selectedExamCode} của bạn bị hủy do vi phạm quy chế kiểm tra.`;
            document.getElementById('cheat-penalty-message').style.display = 'block';
            document.getElementById('answer-review').style.display = 'none';
            
            // Đặt tất cả điểm chi tiết về 0
            document.getElementById('mc-score').textContent = '0';
            document.getElementById('tf-score').textContent = '0';
            document.getElementById('sa-score').textContent = '0';
        } else {
            document.getElementById('score').textContent = `${totalScore.toFixed(2)}/10`;
            document.getElementById('score').className = 'score';
            document.getElementById('result-details').textContent = 
                `Bạn đã hoàn thành bài kiểm tra ${getExamName(selectedExam)} - Đề ${selectedExamCode} với số điểm ${totalScore.toFixed(2)}/10.`;
            document.getElementById('cheat-penalty-message').style.display = 'none';
            document.getElementById('answer-review').style.display = 'block';
            
            // Hiển thị điểm chi tiết
            document.getElementById('mc-score').textContent = scores.mcScore.toFixed(2);
            document.getElementById('tf-score').textContent = scores.tfScore.toFixed(2);
            document.getElementById('sa-score').textContent = scores.saScore.toFixed(2);
            
            // Hiển thị đánh giá chi tiết
            showAnswerReview(scores);
        }
        
        // Cuộn đến phần kết quả
        document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Hàm tính điểm chi tiết
   // Hàm tính điểm chi tiết - SỬA ĐỂ TÍNH ĐÚNG THEO SỐ CÂU THỰC TẾ
function calculateDetailedScores() {
    let mcScore = 0;
    let tfScore = 0;
    let saScore = 0;
    
    const answerKey = examAnswers[`${selectedExam}-${selectedExamCode}`];
    
    if (!answerKey) {
        // Nếu không có đáp án cho mã đề này, trả về điểm 0
        console.log(`Không tìm thấy đáp án cho đề: ${selectedExam}-${selectedExamCode}`);
        return { mcScore, tfScore, saScore, totalScore: 0 };
    }
    
    // Tính điểm phần trắc nghiệm nhiều lựa chọn (luôn 12 câu)
    for (let i = 1; i <= 12; i++) {
        const selectedAnswer = document.querySelector(`input[name="q${i}"]:checked`);
        if (selectedAnswer && selectedAnswer.value === answerKey.multipleChoice[i-1]) {
            mcScore += 0.25;
        }
    }
    
    // Tính điểm phần trắc nghiệm đúng/sai - SỬA: TÍNH ĐÚNG SỐ CÂU THỰC TẾ
    const trueFalseCount = answerKey.trueFalse ? answerKey.trueFalse.length : 0;
    for (let i = 1; i <= trueFalseCount; i++) {
        const correctAnswers = answerKey.trueFalse[i-1];
        
        // Kiểm tra 4 ý con trong mỗi câu
        const subQuestions = ['a', 'b', 'c', 'd'];
        subQuestions.forEach((sub, index) => {
            const selectedAnswer = document.querySelector(`input[name="tf${i}_${sub}"]:checked`);
            if (selectedAnswer && selectedAnswer.value === correctAnswers[index]) {
                tfScore += 0.25; // Mỗi ý đúng được 0.25 điểm
            }
        });
    }
    
    // Tính điểm phần trả lời ngắn - SỬA: TÍNH ĐÚNG SỐ CÂU THỰC TẾ
    const shortAnswerCount = answerKey.shortAnswer ? answerKey.shortAnswer.length : 0;
    for (let i = 1; i <= shortAnswerCount; i++) {
        const userAnswer = document.getElementById(`sa${i}`).value.trim();
        const correctAnswer = answerKey.shortAnswer[i-1];
        
        // So sánh đáp án (có thể thêm logic chuẩn hóa nếu cần)
        if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
            saScore += 0.5;
        }
    }
    
    const totalScore = mcScore + tfScore + saScore;
    return { mcScore, tfScore, saScore, totalScore };
}
    // Hàm hiển thị đánh giá chi tiết - SỬA ĐỂ HIỂN THỊ ĐÚNG SỐ CÂU
function showAnswerReview(scores) {
    const answerDetails = document.getElementById('answer-details');
    answerDetails.innerHTML = '';
    
    const answerKey = examAnswers[`${selectedExam}-${selectedExamCode}`];
    
    if (!answerKey) {
        answerDetails.innerHTML = '<p>Không có thông tin đáp án cho đề này.</p>';
        return;
    }
    
    // Hiển thị đáp án phần trắc nghiệm nhiều lựa chọn
    let mcReview = '<h4>Phần A: Trắc nghiệm nhiều lựa chọn (3 điểm)</h4>';
    for (let i = 1; i <= 12; i++) {
        const selectedAnswer = document.querySelector(`input[name="q${i}"]:checked`);
        const userAnswer = selectedAnswer ? selectedAnswer.value : 'Chưa chọn';
        const correctAnswer = answerKey.multipleChoice[i-1];
        const isCorrect = userAnswer === correctAnswer;
        
        mcReview += `<p><strong>Câu ${i}:</strong> `;
        mcReview += `<span class="user-answer">${userAnswer}</span> `;
        if (isCorrect) {
            mcReview += `<span class="correct-answer">(Đúng)</span>`;
        } else {
            mcReview += `<span class="wrong-answer">(Sai) → Đáp án đúng: <span class="correct-answer">${correctAnswer}</span></span>`;
        }
        mcReview += '</p>';
    }
    
    // Hiển thị đáp án phần đúng/sai - SỬA: HIỂN THỊ ĐÚNG SỐ CÂU
    let tfReview = '<h4>Phần B: Trắc nghiệm đúng/sai</h4>';
    const trueFalseCount = answerKey.trueFalse ? answerKey.trueFalse.length : 0;
    for (let i = 1; i <= trueFalseCount; i++) {
        const correctAnswers = answerKey.trueFalse[i-1];
        tfReview += `<p><strong>Câu ${i}:</strong></p><ul>`;
        
        const subQuestions = ['a', 'b', 'c', 'd'];
        subQuestions.forEach((sub, index) => {
            const selectedAnswer = document.querySelector(`input[name="tf${i}_${sub}"]:checked`);
            const userAnswer = selectedAnswer ? selectedAnswer.value : 'Chưa chọn';
            const correctAnswer = correctAnswers[index];
            const isCorrect = userAnswer === correctAnswer;
            
            tfReview += `<li>Ý ${sub}: `;
            tfReview += `<span class="user-answer">${userAnswer}</span> `;
            if (isCorrect) {
                tfReview += `<span class="correct-answer">(Đúng)</span>`;
            } else {
                tfReview += `<span class="wrong-answer">(Sai) → Đáp án đúng: <span class="correct-answer">${correctAnswer}</span></span>`;
            }
            tfReview += '</li>';
        });
        tfReview += '</ul>';
    }
    
    // Hiển thị đáp án phần trả lời ngắn - SỬA: HIỂN THỊ ĐÚNG SỐ CÂU
    let saReview = '<h4>Phần C: Trả lời ngắn</h4>';
    const shortAnswerCount = answerKey.shortAnswer ? answerKey.shortAnswer.length : 0;
    for (let i = 1; i <= shortAnswerCount; i++) {
        const userAnswer = document.getElementById(`sa${i}`).value.trim();
        const correctAnswer = answerKey.shortAnswer[i-1];
        const isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();
        
        saReview += `<p><strong>Câu ${i}:</strong> `;
        saReview += `<span class="user-answer">${userAnswer || 'Chưa trả lời'}</span> `;
        if (isCorrect) {
            saReview += `<span class="correct-answer">(Đúng)</span>`;
        } else {
            saReview += `<span class="wrong-answer">(Sai) → Đáp án đúng: <span class="correct-answer">${correctAnswer}</span></span>`;
        }
        saReview += '</p>';
    }
    
    answerDetails.innerHTML = mcReview + tfReview + saReview;
}    
        
    
    
    
    // Hàm quay lại trang chủ
    function goHome() {
        // Reset thời gian
        timeLeft = 60 * 60;
        isExamActive = false;
        cheatDetected = false;
        violationCount = 0;
        
        // Ẩn tất cả các phần, chỉ hiển thị menu chính
        document.getElementById('exam-selection').style.display = 'none';
        document.getElementById('exam-container').style.display = 'none';
        document.getElementById('result-container').style.display = 'none';
        
        // Reset giao diện
        document.getElementById('score').className = 'score';
        document.getElementById('cheat-penalty-message').style.display = 'none';
        document.getElementById('answer-review').style.display = 'none';
        
        // Cuộn lên đầu trang
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Hàm chuyển đổi chế độ fullscreen
    function toggleFullscreen() {
        if (!isFullscreen) {
            enterFullscreen();
        } else {
            exitFullscreen();
        }
    }
    
    // Hàm vào chế độ fullscreen
    function enterFullscreen() {
        const elem = document.documentElement;
        
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) { // Firefox
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) { // Chrome, Safari và Opera
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { // IE/Edge
            elem.msRequestFullscreen();
        }
        
        isFullscreen = true;
    }
    
    // Hàm thoát chế độ fullscreen
    function exitFullscreen() {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.mozCancelFullScreen) { // Firefox
            document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) { // Chrome, Safari và Opera
            document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { // IE/Edge
            document.msExitFullscreen();
        }
        
        isFullscreen = false;
    }
    
    // Theo dõi sự kiện fullscreen change
    document.addEventListener('fullscreenchange', fullscreenChangeHandler);
    document.addEventListener('mozfullscreenchange', fullscreenChangeHandler);
    document.addEventListener('webkitfullscreenchange', fullscreenChangeHandler);
    document.addEventListener('msfullscreenchange', fullscreenChangeHandler);
    
    function fullscreenChangeHandler() {
        isFullscreen = !!(document.fullscreenElement || 
                         document.mozFullScreenElement || 
                         document.webkitFullscreenElement || 
                         document.msFullscreenElement);
    }
    
    // Hàm bắt đầu phát hiện gian lận
    function startCheatDetection() {
        // Theo dõi sự kiện visibility change (chuyển tab)
        document.addEventListener('visibilitychange', handleVisibilityChange);
        
        // Theo dõi sự kiện blur/focus (rời khỏi cửa sổ)
        window.addEventListener('blur', handleWindowBlur);
        window.addEventListener('focus', handleWindowFocus);
        
        // Theo dõi chuột rời khỏi cửa sổ
        document.addEventListener('mouseleave', handleMouseLeave);
    }
    
    // Xử lý khi người dùng chuyển tab
    function handleVisibilityChange() {
        if (!isExamActive) return;
        
        if (document.hidden) {
            // Người dùng đã chuyển tab
            handleCheatViolation('Chuyển tab khác');
        }
    }
    
    // Xử lý khi cửa sổ bị mất focus
    function handleWindowBlur() {
        if (!isExamActive) return;
        
        // Kiểm tra xem có phải do chuyển tab không
        // Nếu không phải do chuyển tab (document không hidden) thì đây là rời khỏi cửa sổ
        if (!document.hidden) {
            handleCheatViolation('Rời khỏi cửa sổ trình duyệt');
        }
    }
    
    // Xử lý khi cửa sổ được focus lại
    function handleWindowFocus() {
        if (!isExamActive) return;
        
        lastFocusTime = Date.now();
    }
    
    // Xử lý khi chuột rời khỏi cửa sổ
    function handleMouseLeave(e) {
        if (!isExamActive) return;
        
        // Chỉ xử lý nếu chuột đi lên trên cùng (có thể để chuyển tab)
        if (e.clientY <= 0) {
            handleCheatViolation('Chuột rời khỏi cửa sổ');
        }
    }
    
    // Xử lý vi phạm
    function handleCheatViolation(reason) {
        if (!isExamActive || cheatDetected) return;
        
        violationCount++;
        
        // Cập nhật thông báo cảnh báo
        document.getElementById('warning-count').textContent = violationCount;
        
        if (violationCount <= 3) {
            // Hiển thị cảnh báo
            document.getElementById('warning-message').style.display = 'block';
            
            // Hiệu ứng cảnh báo
            document.getElementById('timer').style.color = '#e74c3c';
            document.getElementById('timer').style.animation = 'none';
            setTimeout(() => {
                document.getElementById('timer').style.animation = 'pulse 0.5s 3';
            }, 10);
            
            // Ẩn cảnh báo sau 5 giây
            setTimeout(() => {
                document.getElementById('warning-message').style.display = 'none';
            }, 5000);
        } else {
            // Phát hiện gian lận, hủy bài thi
            cheatDetected = true;
            document.getElementById('cheat-detected-message').style.display = 'block';
            document.getElementById('warning-message').style.display = 'none';
            
            // Tự động nộp bài với 0 điểm sau 3 giây
            setTimeout(() => {
                submitExam();
            }, 3000);
        }
    }
    
    // Ngăn chặn thoát khỏi trang khi đang thi
    window.addEventListener('beforeunload', function (e) {
        if (isExamActive) {
            e.preventDefault();
            e.returnValue = 'Bạn đang trong bài kiểm tra. Nếu thoát ra, bài kiểm tra của bạn sẽ bị hủy với 0 điểm. Bạn có chắc chắn muốn thoát?';
        }
    });
    
    // Tạo hiệu ứng pulse cho cảnh báo
    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    `;
    document.head.appendChild(style);
    // Thêm các biến zoom
let currentZoom = 1;
const ZOOM_STEP = 0.2;
const MIN_ZOOM = 0.5;
const MAX_ZOOM = 2.0;

// Hàm phóng to
function zoomIn() {
    if (currentZoom < MAX_ZOOM) {
        currentZoom += ZOOM_STEP;
        applyZoom();
    }
}

// Hàm thu nhỏ
function zoomOut() {
    if (currentZoom > MIN_ZOOM) {
        currentZoom -= ZOOM_STEP;
        applyZoom();
    }
}

// Hàm reset zoom
function resetZoom() {
    currentZoom = 1;
    applyZoom();
}

// Áp dụng zoom
function applyZoom() {
    const frame = document.getElementById('exam-frame');
    if (frame) {
        frame.style.transform = `scale(${currentZoom})`;
        frame.style.transformOrigin = 'top left';
        frame.style.width = `${100 / currentZoom}%`;
        frame.style.height = `${100 / currentZoom}%`;
        
        // Hiển thị thông báo zoom
        showZoomMessage(`Đang xem ở tỷ lệ: ${Math.round(currentZoom * 100)}%`);
    }
}

// Hiển thị thông báo zoom
function showZoomMessage(message) {
    let messageDiv = document.getElementById('zoom-message');
    if (!messageDiv) {
        messageDiv = document.createElement('div');
        messageDiv.id = 'zoom-message';
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 14px;
            animation: fadeOut 2s forwards;
        `;
        document.body.appendChild(messageDiv);
    }
    
    messageDiv.textContent = message;
    messageDiv.style.animation = 'none';
    setTimeout(() => {
        messageDiv.style.animation = 'fadeOut 2s forwards';
    }, 10);
}

// Thêm animation fadeOut
const zoomStyle = document.createElement('style');
zoomStyle.textContent = `
    @keyframes fadeOut {
        0% { opacity: 1; }
        70% { opacity: 1; }
        100% { opacity: 0; }
    }
`;
document.head.appendChild(zoomStyle);

// Thêm CSS cho iframe khi zoom
const iframeStyle = document.createElement('style');
iframeStyle.textContent = `
    .exam-frame {
        transition: transform 0.3s ease;
    }
    
    .exam-frame-container {
        overflow: auto;
        border: 2px solid #3498db;
        background: white;
    }
`;
document.head.appendChild(iframeStyle);
// Thêm sự kiện bàn phím
document.addEventListener('keydown', function(e) {
    if (!isExamActive) return;
    
    // Ctrl + + để phóng to
    if ((e.ctrlKey || e.metaKey) && e.key === '+') {
        e.preventDefault();
        zoomIn();
    }
    
    // Ctrl + - để thu nhỏ
    if ((e.ctrlKey || e.metaKey) && e.key === '-') {
        e.preventDefault();
        zoomOut();
    }
    
    // Ctrl + 0 để reset
    if ((e.ctrlKey || e.metaKey) && e.key === '0') {
        e.preventDefault();
        resetZoom();
    }
});

    </script>
</body>
</html>



